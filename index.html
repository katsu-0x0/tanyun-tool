<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">

  <!-- iPhone 入力時ズーム防止 -->
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>タンユン体力計算</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 420px;
      margin: 0 auto;
      overflow-x: hidden;
    }

    h2 {
      text-align: center;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    td {
      border: 1px solid #ccc;
      padding: 8px 10px;
      font-size: 14px;
    }

    .input { background: #ffe5cc; }
    .fixed { background: #e0e0e0; }
    .result { background: #dbe9ff; font-weight: bold; }

    /* iPhone 強制ズーム対策（最重要） */
    input, select, button {
      font-size: 16px !important;
      width: 100%;
      box-sizing: border-box;
    }

    .stage-wrap {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stage-wrap input {
      width: 80px;
      flex-shrink: 0;
    }
    /* iPhone Safari の time入力はみ出し対策 */
    input[type="time"] {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box;
    }

    /* 表レイアウト固定（はみ出し防止） */
    table {
      table-layout: fixed;
    }

    td {
      overflow: hidden;
    }

  </style>
</head>
<body>

<h2>タンユン体力計算</h2>

<table>
  <tr>
    <td class="fixed">現在時刻</td>
    <td>
      <input class="input" type="time" id="currentTime" step="60">
    </td>
  </tr>

  <tr>
    <td class="fixed">現在ステージ</td>
    <td>
      <div class="stage-wrap">
        <input class="input" type="number" id="currentStage" min="1" max="10" placeholder="例: 6">
        <span>ステージ</span>
      </div>
    </td>
  </tr>

  <tr>
    <td class="fixed">現在体力</td>
    <td><input class="input" type="number" id="currentStamina" placeholder="例: 80"></td>
  </tr>

  <tr>
    <td class="fixed">手持ち枚数</td>
    <td><input class="input" type="number" id="ticketCount" placeholder="例: 6"></td>
  </tr>

  <tr>
    <td class="fixed">回復アイテム数</td>
    <td><input class="input" type="number" id="itemCount" placeholder="例: 3"></td>
  </tr>

  <tr>
    <td class="result">時間回復含む想定獲得ポイント数</td>
    <td class="result" id="totalPoint">-</td>
  </tr>

  <tr>
    <td class="result">到達ステージ</td>
    <td class="result" id="clearStage">-</td>
  </tr>

  <tr>
    <td class="result">到達ステージクリアに必要な体力</td>
    <td class="result" id="needStamina">-</td>
  </tr>
</table>

<script>
  // ===== 裏設定 =====
  const hiddenEndTime = "22:00";

  // ===== ステージごとのクリア必要ポイント（唯一の表）=====
  const stageClearPointTable = {
//     1: 360,
//     2: 1440,
//     3: 2700,
//     4: 4560,
//     5: 6600,
//     6: 8880,
//     7: 11400,
//     8: 14460,
//     9: 17860,
//     10: 21860
     1: 0,
     2: 360,
     3: 1440,
     4: 2700,
     5: 4560,
     6: 6600,
     7: 8880,
     8: 11400,
     9: 14460,
     10: 17860
  };

  function setNowTime() {
    const now = new Date();
    const hh = String(now.getHours()).padStart(2, "0");
    const mm = String(now.getMinutes()).padStart(2, "0");
    document.getElementById("currentTime").value = `${hh}:${mm}`;
  }

  function calc() {
    const now = new Date();

    const timeValue = document.getElementById("currentTime").value;
    if (!timeValue) return;

    const [ch, cm] = timeValue.split(":").map(Number);
    const currentDate = new Date(now);
    currentDate.setHours(ch, cm, 0, 0);

    const [eh, em] = hiddenEndTime.split(":").map(Number);
    const endDate = new Date(now);
    endDate.setHours(eh, em, 0, 0);

    const remainMin = Math.max(0, (endDate - currentDate) / 60000);
    const futureRecovery = Math.floor(remainMin / 2); // 2分で1回復

    const currentStamina = Number(document.getElementById("currentStamina").value) || 0;
    const ticketCount = Number(document.getElementById("ticketCount").value) || 0;
    const itemCount = Number(document.getElementById("itemCount").value) || 0;
    const currentStage = Number(document.getElementById("currentStage").value) || 1;

    // ===== 合計体力（内部）=====
    const totalStamina =
      currentStamina +
      futureRecovery +
      ticketCount +
      (itemCount * 10);

    // 体力 → ポイント（体力3で60点 → 体力1で20点）
    const staminaPoint = totalStamina * 20;

    // ===== 到達可能ステージ（クリア基準）=====
    let maxStage = currentStage;
    for (const stage in stageClearPointTable) {
      if (staminaPoint >= stageClearPointTable[stage]) {
        maxStage = Number(stage);
      }
    }

    // ===== 合計ポイント（入場時：1つ前のステージ）=====
    const prevStage = Math.max(0, currentStage - 1);
    const entryBasePoint = stageClearPointTable[prevStage] || 0;

    const totalPoint = staminaPoint + entryBasePoint;

    // ===== 次ステージまで必要体力 =====
    const nextStage = maxStage + 1;
    const nextClearPoint = stageClearPointTable[nextStage];

    let needStamina = "-";
    if (nextClearPoint !== undefined) {
      const needPoint = nextClearPoint - staminaPoint;
      needStamina = needPoint > 0
        ? Math.ceil(needPoint / 20)
        : 0;
    }

    document.getElementById("totalPoint").textContent = totalPoint + " 点";
    document.getElementById("clearStage").textContent = maxStage + " ステージ";
    document.getElementById("needStamina").textContent = "HP " + needStamina;
  }

  setNowTime();
  setInterval(calc, 1000);
  calc();
</script>

</body>
</html>
